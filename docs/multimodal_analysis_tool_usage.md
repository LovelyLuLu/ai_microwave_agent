# 多模态仿真结果图像分析工具使用指南

## 概述

`MULTIMODAL_ANALYSIS` 工具是基于多模态大模型 `qwen_vl_max` 开发的 LangChain 工具，用于智能分析 HFSS 仿真结果图像。该工具能够自动识别和分析 S 参数图像（S11、S21、S12、S22）和 VSWR 图像，生成专业的技术分析报告。

## 主要功能

### 1. 智能图像识别
- **自动识别图像类型**：准确识别 S11、S21、S12、S22、VSWR 等仿真结果图像
- **数据完整性检查**：评估图像数据的质量和完整性
- **坐标轴信息提取**：自动读取频率范围、数值范围等关键信息

### 2. 专业性能分析
- **S参数深度分析**：
  - 反射参数（S11、S22）：回波损耗、谐振频率、带宽特性
  - 传输参数（S21、S12）：插入损耗、传输特性、频率响应
- **VSWR特性分析**：匹配性能评估、频率特性分析
- **关键指标提取**：自动读取和计算重要的性能指标数值

### 3. 智能报告生成
- **专业技术报告**：基于工程实践的专业分析报告
- **器件类型推断**：根据 S 参数特征推断器件类型
- **优化建议**：提供具体的设计改进建议
- **多格式输出**：支持 Markdown 和 JSON 格式报告

## 环境配置

### 1. API 密钥配置

在项目根目录的 `.env` 文件中添加 DashScope API 密钥：

```bash
DASHSCOPE_API_KEY=your_api_key_here
```

### 2. 依赖安装

确保已安装必要的依赖包：

```bash
pip install dashscope python-dotenv
```

## 参数说明

### 必需参数
无（所有参数都有默认值）

### 可选参数

| 参数名 | 类型 | 默认值 | 描述 |
|--------|------|--------|------|
| `results_dir` | str | "results" | 仿真结果图像文件夹路径 |
| `include_s_parameters` | bool | true | 是否分析S参数图像 |
| `include_vswr` | bool | true | 是否分析VSWR图像 |
| `output_format` | str | "markdown" | 报告格式（markdown/json） |
| `save_report` | bool | true | 是否保存报告到文件 |
| `report_filename` | str | None | 自定义报告文件名 |

## 使用方法

### 通过 Agent 调用（推荐）

#### 基本使用
```bash
# 使用默认配置分析results文件夹中的所有图像
请使用多模态分析工具分析仿真结果图像
```

#### 自定义配置
```bash
# 只分析S参数图像，输出JSON格式报告
请使用多模态分析工具分析S参数图像，输出JSON格式报告，不包括VSWR分析
```

#### 指定文件夹
```bash
# 分析指定文件夹中的图像
请使用多模态分析工具分析custom_results文件夹中的仿真结果图像
```

### 直接调用

```python
from tools.multimodal_analysis_tool import MULTIMODAL_ANALYSIS

# 基本调用
result = MULTIMODAL_ANALYSIS.run({})
print(result)

# 自定义参数调用
result = MULTIMODAL_ANALYSIS.run({
    "results_dir": "custom_results",
    "include_s_parameters": True,
    "include_vswr": False,
    "output_format": "json",
    "report_filename": "my_analysis_report.json"
})
print(result)
```

## 支持的图像格式

### 文件命名规范
工具会自动查找以下命名的图像文件：

- **S参数图像**：
  - `S_1_1.png` (S11)
  - `S_2_1.png` (S21)
  - `S_1_2.png` (S12)
  - `S_2_2.png` (S22)

- **VSWR图像**：
  - `VSWR.png`

### 支持的图像格式
- PNG（推荐）
- JPG/JPEG

## 输出示例

### 终端输出
```
🔍 多模态仿真结果图像分析完成！

📊 分析统计：
  - 分析图像数量: 5
  - S参数图像: 4
  - VSWR图像: 1
  - 使用模型: qwen-vl-max
  - 分析时间: 2024-01-20T10:30:45.123456

💾 分析报告已保存到results文件夹

📋 分析报告：

## 1. 图像识别与基本信息
...
```

### 报告文件
分析完成后，会在指定目录生成报告文件：

- **Markdown格式**：`multimodal_analysis_report_YYYYMMDD_HHMMSS.md`
- **JSON格式**：`multimodal_analysis_report_YYYYMMDD_HHMMSS.json`

## 分析报告结构

生成的分析报告包含以下主要部分：

### 1. 图像识别与基本信息
- 图像类型识别
- 频率范围确认
- 数据完整性评估
- 坐标轴信息

### 2. S参数详细分析
- **反射参数分析**（S11, S22）
  - 回波损耗性能
  - 谐振特性
  - 带宽分析
- **传输参数分析**（S21, S12）
  - 插入损耗特性
  - 传输特性
  - 对称性分析

### 3. VSWR深度分析
- 数值范围分析
- 匹配性能评估
- 频率特性分析

### 4. 器件类型推断与性能评估
- 器件类型判断
- 性能等级评估
- 优势与不足分析

### 5. 工程建议与优化方向
- 设计优化建议
- 应用适用性评估
- 进一步仿真建议

### 6. 技术结论与总结
- 关键性能指标汇总
- 整体设计质量评价
- 应用前景评估

## 错误处理

### 常见错误及解决方案

1. **API密钥未配置**
   ```
   错误：未找到DASHSCOPE_API_KEY环境变量
   解决：在.env文件中配置正确的API密钥
   ```

2. **图像文件不存在**
   ```
   错误：结果文件夹不存在: results
   解决：确保指定的文件夹存在且包含图像文件
   ```

3. **没有找到图像文件**
   ```
   错误：未找到可分析的图像文件
   解决：检查文件夹中是否包含正确命名的PNG图像文件
   ```

4. **模型调用失败**
   ```
   错误：模型调用失败 (状态码: 400)
   解决：检查API密钥是否有效，网络连接是否正常
   ```

## 最佳实践

### 1. 图像质量要求
- 使用高分辨率的PNG格式图像
- 确保图像清晰，坐标轴和数值可读
- 避免图像过度压缩导致的质量损失

### 2. 文件组织
- 将所有仿真结果图像放在同一文件夹中
- 使用标准的文件命名规范
- 定期清理过期的分析报告

### 3. 分析策略
- 对于复杂器件，建议分别分析不同类型的参数
- 结合数值分析工具的结果进行对比验证
- 保存分析报告用于设计迭代和优化

## 技术支持

如果在使用过程中遇到问题，请检查：

1. 环境配置是否正确
2. 图像文件是否符合要求
3. API密钥是否有效
4. 网络连接是否正常

更多技术细节请参考工具源码中的详细注释。